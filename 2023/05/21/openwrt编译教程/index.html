<!DOCTYPE html><html lang="en" theme-mode="dark"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>openwrt编译教程 | xue的个人博客</title><link rel="icon" type="image/x-icon" href="/favicon.ico"><script>var config = {"root":"/","search":{"preload":false,"activeHolder":"Enter here","blurHolder":"Search","noResult":"Data \"$0\" not found"},"code":{"codeInfo":"$0 - $1 lines","copy":"copy","copyFinish":"copied","expand":"expand"}}</script><script src="//unpkg.com/mermaid@9.2.2/dist/mermaid.min.js"></script><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lightgallery.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-zoom.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-thumbnail.css"><link type="text/css" rel="stylesheet" href="/lib/fontawesome/brands.min.css"><link type="text/css" rel="stylesheet" href="/lib/fontawesome/fontawesome.min.css"><link rel="stylesheet" href="/css/arknights.css"><script>if (window.localStorage.getItem('theme-mode') === 'light') document.documentElement.setAttribute('theme-mode', 'light')
if (window.localStorage.getItem('theme-mode') === 'dark') document.documentElement.setAttribute('theme-mode', 'dark')</script><style>@font-face {
 font-family: BenderLight;
 src: local('Bender'), url("/font/BenderLight.ttf");
}
@font-face {
 font-family: 'JetBrains Mono';
 src: local('JetBrains Mono'), url('/font/JetBrainsMono-Regular.woff2') format('woff2');
}
@font-face {
 font-family: 'Font Awesome 6 Brands';
 src: local('Font Awesome 6 Brands'), url('/lib/fontawesome/fa-brands.woff2') format('woff2');
}
@font-face {
 font-family: 'Font Awesome 6 Free';
 src: local('Font Awesome 6 Free'), url('/lib/fontawesome/fa-regular.woff2') format('woff2');
}</style><style>:root {
  --dark-background: url('https://ak.hypergryph.com/assets/index/images/ak/pc/bk.jpg');
  --light-background: url('/img/bk.jpg');
}</style><meta name="generator" content="Hexo 7.0.0-rc2"></head><body><div class="loading" style="opacity: 0"><div class="loadingBar left"></div><div class="loadingBar right"></div></div><main><header class="closed"><nav><div class="navBtn hide"><i class="navBtnIcon"><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span></i></div><div class="navItem" id="search-header"><span class="navItemTitle"><input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="Search" spellcheck="false" maxlength="50" type="text" id="search-input"></span></div><div class="navItem" id="search-holder"></div><div class="search-popup"><div id="search-result"></div></div><ol class="navContent"><li class="navItem"><a class="navBlock" href="/"><span class="navItemTitle">Home</span></a></li><li class="navItem" matchdata="categories,tags"><a class="navBlock" href="/archives/"><span class="navItemTitle">Archives</span></a></li><li class="navItem"><a class="navBlock" href="/categories/"><span class="navItemTitle">About</span></a></li></ol></nav></header><article><div id="post-bg"><div id="post-title"><h1>openwrt编译教程</h1><div id="post-info"><span>First Post: <div class="control"><time datetime="2023-05-20T17:09:10.000Z" id="date"> 2023-05-21</time></div></span><br><span>Last Update: <div class="control"><time datetime="2023-09-18T07:55:46.396Z" id="updated"> 2023-09-18</time></div></span><br><span>Word Count: <div class="control">1.3k</div></span><br><span>Read Time: <div class="control">5 min</div></span></div></div><hr><div id="post-content"><p>编译openwrt建议在非大陆的云服务器上进行（竞价实例真香，比去网吧打游戏还便宜），可以有效提高下载依赖等文件的成功率，如果持续需要编译，可以编译一次全插件全驱动的，然后吧dl文件夹打个包下载到本地完成之后的编译，避免持续缴费</p>
<p>建议使用Ubuntu系统，教程多，出了问题搜起来也简单一些，可以用WSL但是不建议在ntfs以及refs文件系统中编译，不建议使用powershell进行编译</p>
<p>然后安利一下Microsoft Terminal <a href="https://link.zhihu.com/?target=https://github.com/microsoft/terminal">https://github.com/microsoft/terminal</a></p>
<p>也可以在Windows应用商店下载</p>
<span id="more"></span>
<p class='item-img' data-src='https://pic4.zhimg.com/80/v2-95b0bc29e566098b3e5cc664f956d7eb_720w.jpg'><img src="https://pic4.zhimg.com/80/v2-95b0bc29e566098b3e5cc664f956d7eb_720w.jpg" alt="img"></p>
<p>One Half Dark这个默认配色深得我心</p>
<hr>
<h2 id="正文："><a href="#正文：" class="headerlink" title="正文："></a>正文：</h2><p>不要使用root用户，Ubuntu默认用户是ubuntu可以直接使用，其他系统或登录就是root的情况，考虑新建一个用户再来进行编译</p>
<p>以下内容可以直接复制到终端中运行，#开头的行会被终端忽略，一起复制也没有问题</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs text">#编译前的准备<br><br>####更新软件（可选）####<br>sudo sh -c &quot;apt update &amp;&amp; apt upgrade -y&quot;<br>########################<br><br>#安装依赖<br>sudo apt-get -y install build-essential asciidoc binutils bzip2 gawk gettext git libncurses5-dev libz-dev patch python3 python2.7 unzip zlib1g-dev lib32gcc1 libc6-dev-i386 subversion flex uglifyjs git-core gcc-multilib p7zip p7zip-full msmtp libssl-dev texinfo libglib2.0-dev xmlto qemu-utils upx libelf-dev autoconf automake libtool autopoint device-tree-compiler g++-multilib antlr3 gperf wget curl swig rsync libelf-dev python3-distutils<br><br>#克隆源码<br>git clone https://github.com/coolsnowwolf/lede.git<br><br>#进入源码文件夹<br>cd lede<br><br>######添加自定义源（可选）##########<br>cat &gt;&gt; feeds.conf.default &lt;&lt;EOF<br>src-git kenzo https://github.com/kenzok8/openwrt-packages<br>src-git passwall https://github.com/xiaorouji/openwrt-passwall<br>src-git nas https://github.com/linkease/nas-packages.git<br>EOF<br>####################################<br><br>#更新并安装feeds.conf.default中配置的源<br>./scripts/feeds update -a &amp;&amp; ./scripts/feeds install -a<br><br>######添加 OpenAppFilter 应用过滤插件（可选）####<br>git clone https://github.com/destan19/OpenAppFilter package/OpenAppFilter<br>#################################################<br><br>######更改默认主题（可选）###########<br># 删除自定义源默认的 argon 主题<br>rm -rf package/lean/luci-theme-argon<br># 拉取 argon 原作者的源码<br>git clone -b 18.06 https://github.com/jerrykuku/luci-theme-argon.git package/lean/luci-theme-argon<br># 替换默认主题为 luci-theme-argon<br>sed -i &#x27;s/luci-theme-bootstrap/luci-theme-argon/&#x27; feeds/luci/collections/luci/Makefile<br>#make menuconfig时记得勾选LuCI ---&gt; Applications ---&gt; luci-app-argon-config<br>#####################################<br><br>####设置路由器默认的管理地址为.5.1（可选）###<br>sed -i &#x27;s/192.168.1.1/192.168.5.1/g&#x27; package/base-files/files/bin/config_generate<br>#############################################<br><br>#根据需要选插件<br>make menuconfig<br>#记得在Target Images适当扩大系统分区和镜像大小<br>#系统分区，驱动或插件多的话需要适当扩大这个分区<br>#(128) Kernel partition size (in MB)<br>#文件系统分区，基本可以理解为安装后默认的/overlay分区大小<br>#(512) Root filesystem partition size (in MB)<br><br>#下载编译所需的软件包<br>make download -j8 V=s<br><br>#看看有没有没下完整的包，这是查看dl目录下有没有1k以下的文件，有的话建议删除重新下，很可能没下完整<br>find dl -size -1024c -exec ls -l &#123;&#125; \;<br>#删除<br>find dl -size -1024c -exec rm -f &#123;&#125; \;<br></code></pre></td></tr></table></figure>

<p>现在区分首次编译和二次编译</p>
<h3 id="首次编译"><a href="#首次编译" class="headerlink" title="首次编译"></a>首次编译</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs text"># -j1：单线程编译<br>make -j1 V=s<br>#这时候如果报错bash: po2lmo: command not found，八成是base没有先编译出来<br>#可以运行以下命令先编译base，然后重新执行make -j1 V=s<br>make package/feeds/luci/luci-base/compile V=s<br>#剩下的可能就是插件冲突之类的，没有很好的办法，慢慢排查吧<br></code></pre></td></tr></table></figure>

<h3 id="二次编译"><a href="#二次编译" class="headerlink" title="二次编译"></a>二次编译</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs text">#首先肯定是要进入lede目录: cd lede<br><br>#拉取最新代码<br>git pull<br>#更新下载安装订阅源包含的软件包<br>./scripts/feeds update -a &amp;&amp; ./scripts/feeds install -af<br><br>#清理旧文件<br>#如果只是调整检查和驱动等<br>make clean<br>#如果需要调整架构，或者之前编译出错<br>make dirclean<br>#删除旧的配置文件<br>rm -rf ./tmp &amp;&amp; rm -rf .config<br>#选择插件<br>make menuconfig<br>#下载包<br>make download -j8 V=s<br>#优先使用多线程编译，出错则使用单线程并输出详细信息<br>make -j$(nproc) ||  make -j1 V=s<br></code></pre></td></tr></table></figure>

<p>一些工具：</p>
<ul>
<li>因为编译对网络环境有点要求，通常使用海外的服务器进行编译，就存在一个传输问题，特别是dl之类的目录需要下载回国内时，传输还是很费劲的，推荐一个Linux上直接可以上传Google云盘的工具：<a href="https://link.zhihu.com/?target=https://github.com/veip007/Linux-to-Google-Drive">GitHub - veip007&#x2F;Linux-to-Google-Drive: Linux下谷歌网盘同步工具、自动备份VPS文件到Google Drive</a></li>
<li>如果是按流量计费那么压缩完上传可能会省个几块钱(7z真好用)：</li>
</ul>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs text">7za a -m0=lzma -mx=9 -ms=on lede.7z lede/ &amp;<br></code></pre></td></tr></table></figure>

<ul>
<li>有些朋友私信来问我怎么配hyper-v：<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/149216481">得到发生：Hyper-V虚拟机安装OpenWRT软路由系统 （双网口主路由）</a></li>
</ul>
<p>这个朋友已经写得很详细了，可以参考一下他的，别忘了看完给人家点个赞</p>
<p>坑：</p>
<ul>
<li>不清楚是不是我的网络问题还是和哪个插件冲突AdGuard Home一旦勾选，有概率编译失败，编译成功该插件也无法正常使用</li>
</ul>
<p>参考：</p>
<p><a href="https://link.zhihu.com/?target=https://www.moewah.com/archives/4003.html">OpenWrt 固件自编译教程：从入门到酸爽！ - 喵斯基部落</a></p>
<p><a href="https://link.zhihu.com/?target=https://github.com/fw876/helloworld/issues/8">https://github.com/fw876/hellow</a></p>
<div id="paginator"></div></div><div id="post-footer"><div id="pages"><div class="footer-link" style="width: 50%;text-align:right;border-right:1px #fe2 solid"><a href="/2023/05/21/OPENWRT%E7%BC%96%E8%AF%91%E4%B9%8BUA2F/">← Next OPENWRT编译之UA2F</a></div><div class="footer-link" style="width: 50%;right:1px;border-left:1px #fe2 solid"><a href="/2023/05/21/2021-Archlinux%E5%8F%8C%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B%EF%BC%88%E8%B6%85%E8%AF%A6%E7%BB%86%EF%BC%89/">2021 Archlinux双系统安装教程（超详细） Prev →</a></div></div></div></div><div class="bottom-btn"><div><a id="to-top" onClick="scrolls.scrolltop();" title="To Top" style="opacity: 0; display: none;">∧</a><a id="to-index" href="#toc-div" title="To Catalog">≡</a><a id="color-mode" onClick="colorMode.change()" title="Change Theme"></a></div></div></article><aside><div id="about"><a href="/" id="logo"><img src="https://ak.hypergryph.com/assets/index/images/ak/pc/faction/1.png" alt="Logo"></a><h1 id="Dr"><a href="/">John Doe</a></h1><div id="description"><p></p></div></div><div id="aside-block"><div id="toc-div"><h1>Catalog</h1><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%AD%A3%E6%96%87%EF%BC%9A"><span class="toc-number">1.</span> <span class="toc-text">正文：</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A6%96%E6%AC%A1%E7%BC%96%E8%AF%91"><span class="toc-number">1.1.</span> <span class="toc-text">首次编译</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E6%AC%A1%E7%BC%96%E8%AF%91"><span class="toc-number">1.2.</span> <span class="toc-text">二次编译</span></a></li></ol></li></ol></div></div><footer><nobr>Published with <a target="_blank" rel="noopener" href="http://hexo.io">Hexo</a></nobr><wbr><nobr> Theme <a target="_blank" rel="noopener" href="https://github.com/Yue-plus/hexo-theme-arknights">Arknights</a></nobr><wbr><nobr>by <a target="_blank" rel="noopener" href="https://github.com/Yue-plus">Yue_plus</a></nobr></footer></aside></main><canvas id="canvas-dust"></canvas><script src="/js/search.js"></script><script src="/js/arknights.js"></script><script src="//unpkg.com/lightgallery@2.7.1/lightgallery.min.js"></script><script src="//unpkg.com/lightgallery@2.7.1/plugins/zoom/lg-zoom.min.js"></script><script src="//unpkg.com/lightgallery@2.7.1/plugins/thumbnail/lg-thumbnail.min.js"></script><script src="/js/pjax.js"></script><script class="pjax-js">reset= () => {code.findCode();
document.querySelector('.lg-container')?.remove()
lightGallery(document.getElementById('post-bg'), {
  plugins: [lgZoom,lgThumbnail],
  selector: '.item-img'})}</script><script>window.addEventListener("load",() => {pjax = new Pjax({
 cacheBust: false,
 selectors: ['title','article','#aside-block','.pjax-js'],
 switches: {'article': Pjax.switches.sideBySide},
 switchesOptions: {
   'article': {
     classNames: {
       remove: "pjax-out",
       add: "pjax-in"
     }
   }
 }
});
document.addEventListener("pjax:complete", reset);reset()})</script></body></html>